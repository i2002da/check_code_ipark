<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ê±´ì„¤ ë‚´ì—­ì„œ ì½”ë“œ ê²€í†  ë° í‘œì¤€ë‚´ì—­ ë¹„êµ ì‹œìŠ¤í…œ">
<meta name="theme-color" content="#0d0f14">
<title>ë‚´ì—­ ì½”ë“œ ì²´í¬ ì‹œìŠ¤í…œ</title>

<!-- SheetJS CDN (primary) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"
        integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- SheetJS CDN (fallback) -->
<script>window.XLSX || document.write('<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"><\/script>')</script>

<!-- Google Fonts (optional â€” works offline with system fallback) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:       #0d0f14;
  --surf:     #141820;
  --surf2:    #1c2230;
  --brd:      #252d3d;
  --blue:     #3b82f6;
  --cyan:     #22d3ee;
  --green:    #10b981;
  --yellow:   #f59e0b;
  --red:      #ef4444;
  --purple:   #a855f7;
  --txt:      #e2e8f0;
  --txt-dim:  #64748b;
  --txt-mute: #94a3b8;
  --font-sans: 'Noto Sans KR', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
  --font-mono: 'JetBrains Mono', 'Consolas', monospace;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-sans);
  background: var(--bg);
  color: var(--txt);
  min-height: 100vh;
  line-height: 1.5;
}

/* grid background */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(59,130,246,.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(59,130,246,.03) 1px, transparent 1px);
  background-size: 40px 40px;
}

#app { max-width: 1760px; margin: 0 auto; padding: 24px 20px; position: relative; z-index: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.header {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--brd);
}
.header-logo {
  width: 44px; height: 44px; border-radius: 11px; flex-shrink: 0;
  background: linear-gradient(135deg, var(--blue), var(--cyan));
  display: flex; align-items: center; justify-content: center; font-size: 22px;
}
.header-title { font-size: 21px; font-weight: 900; letter-spacing: -.5px; }
.header-title em { color: var(--blue); font-style: normal; }
.header-sub {
  font-size: 11px; color: var(--txt-dim); margin-top: 2px;
  font-family: var(--font-mono);
}
.header-right { margin-left: auto; }
.gh-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 12px; border-radius: 8px;
  border: 1px solid var(--brd); background: var(--surf);
  color: var(--txt-mute); font-size: 11px; font-weight: 600;
  text-decoration: none; transition: all .15s;
}
.gh-badge:hover { border-color: var(--blue); color: var(--blue); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPLOAD SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.upload-section {
  margin-bottom: 20px;
}
.upload-section-title {
  font-size: 11px; font-weight: 700; color: var(--txt-dim);
  letter-spacing: .8px; text-transform: uppercase;
  margin-bottom: 10px;
}

.upload-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

@media (max-width: 900px) {
  .upload-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 500px) {
  .upload-grid { grid-template-columns: 1fr; }
}

.upcard {
  position: relative;
  background: var(--surf);
  border: 1.5px dashed var(--brd);
  border-radius: 11px;
  padding: 16px 14px;
  cursor: pointer;
  transition: border-color .2s, background .2s;
  overflow: hidden;
}
.upcard::after {
  content: '';
  position: absolute; inset: 0; border-radius: 11px;
  background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,.02));
  pointer-events: none;
}
.upcard:hover, .upcard.drag-over {
  border-color: var(--blue);
  background: rgba(59,130,246,.05);
}
.upcard.loaded      { border-style: solid; }
.upcard.clr-blue    { border-color: var(--blue); }
.upcard.clr-green   { border-color: var(--green); }
.upcard.clr-yellow  { border-color: var(--yellow); }
.upcard.clr-purple  { border-color: var(--purple); }

.upcard input[type="file"] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer;
  width: 100%; height: 100%;
}

.upcard-head { display: flex; align-items: center; gap: 7px; margin-bottom: 5px; }
.upcard-dot  { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.dot-blue   { background: var(--blue); }
.dot-green  { background: var(--green); }
.dot-yellow { background: var(--yellow); }
.dot-purple { background: var(--purple); }
.upcard-name { font-size: 12px; font-weight: 700; }

.upcard-badge {
  margin-left: auto; padding: 2px 7px; border-radius: 10px;
  font-size: 10px; font-weight: 700;
}
.badge-req { background: rgba(239,68,68,.14); color: var(--red); }
.badge-opt { background: rgba(100,116,139,.12); color: var(--txt-dim); }

.upcard-desc {
  font-size: 11px; color: var(--txt-dim); margin-bottom: 8px;
}
.upcard-fn {
  font-size: 11px; color: var(--txt-dim);
  font-family: var(--font-mono);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.upcard-fn.ok { color: var(--green); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.action-bar {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 20px; flex-wrap: wrap;
}
.divider { width: 1px; height: 28px; background: var(--brd); }

.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px; border-radius: 8px;
  font-size: 13px; font-weight: 700;
  font-family: var(--font-sans);
  border: none; cursor: pointer;
  transition: all .15s; white-space: nowrap;
  user-select: none;
}
.btn:disabled { opacity: .35; cursor: not-allowed; transform: none !important; pointer-events: none; }

.btn-blue   { background: var(--blue);   color: #fff; }
.btn-blue:hover   { background: #2563eb; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,.3); }
.btn-purple { background: var(--purple); color: #fff; }
.btn-purple:hover { background: #9333ea; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(168,85,247,.3); }
.btn-ghost {
  background: transparent; color: var(--txt-mute);
  border: 1px solid var(--brd);
}
.btn-ghost:hover { border-color: var(--blue); color: var(--blue); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs {
  display: flex;
  background: var(--surf); border: 1px solid var(--brd);
  border-radius: 10px; padding: 4px;
  width: fit-content; margin-bottom: 16px;
}
.tab {
  padding: 7px 18px; border-radius: 7px;
  font-size: 12px; font-weight: 700;
  font-family: var(--font-sans);
  border: none; cursor: pointer;
  background: transparent; color: var(--txt-dim);
  transition: all .15s; user-select: none;
}
.tab.active-blue   { background: var(--blue);   color: #fff; }
.tab.active-purple { background: var(--purple); color: #fff; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
.stat {
  background: var(--surf); border: 1px solid var(--brd);
  border-radius: 9px; padding: 10px 16px; min-width: 116px;
}
.stat-lbl {
  font-size: 10px; color: var(--txt-dim); margin-bottom: 5px;
  letter-spacing: .5px; text-transform: uppercase; white-space: nowrap;
}
.stat-num {
  font-size: 24px; font-weight: 900;
  font-family: var(--font-mono); line-height: 1;
}
.n-blue   { color: var(--blue); }
.n-green  { color: var(--green); }
.n-yellow { color: var(--yellow); }
.n-red    { color: var(--red); }
.n-cyan   { color: var(--cyan); }
.n-purple { color: var(--purple); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-bar {
  display: flex; gap: 8px; flex-wrap: wrap;
  align-items: center; margin-bottom: 12px;
}
.fbtn {
  padding: 5px 13px; border-radius: 20px;
  font-size: 11px; font-weight: 700;
  font-family: var(--font-sans);
  border: 1px solid var(--brd);
  background: transparent; color: var(--txt-mute);
  cursor: pointer; transition: all .15s; white-space: nowrap;
}
.fbtn:hover { border-color: var(--blue); color: var(--blue); }
.fa-all    { background: var(--blue);   border-color: var(--blue);   color: #fff; }
.fa-ok     { background: var(--green);  border-color: var(--green);  color: #fff; }
.fa-diff   { background: var(--yellow); border-color: var(--yellow); color: #fff; }
.fa-miss   { background: var(--red);    border-color: var(--red);    color: #fff; }
.fa-only1  { background: var(--blue);   border-color: var(--blue);   color: #fff; }
.fa-only2  { background: var(--purple); border-color: var(--purple); color: #fff; }
.fa-both   { background: var(--green);  border-color: var(--green);  color: #fff; }

.search-box {
  margin-left: auto;
  padding: 5px 12px; border-radius: 8px;
  background: var(--surf); border: 1px solid var(--brd);
  color: var(--txt); font-size: 12px;
  font-family: var(--font-sans); width: 200px; outline: none;
}
.search-box:focus { border-color: var(--blue); }
.search-box::placeholder { color: var(--txt-dim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HINT BOX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hint {
  background: rgba(168,85,247,.06); border: 1px solid rgba(168,85,247,.2);
  border-radius: 8px; padding: 10px 14px;
  font-size: 11px; color: var(--txt-mute);
  margin-bottom: 12px; line-height: 1.8;
}
.hint b { color: var(--purple); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tbl-wrap {
  background: var(--surf); border: 1px solid var(--brd);
  border-radius: 11px; overflow: hidden;
}
.tbl-scroll {
  max-height: 60vh; overflow-y: auto; overflow-x: auto;
}
.tbl-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
.tbl-scroll::-webkit-scrollbar-track { background: transparent; }
.tbl-scroll::-webkit-scrollbar-thumb { background: var(--brd); border-radius: 3px; }

table { width: 100%; border-collapse: collapse; font-size: 12px; white-space: nowrap; }

thead { position: sticky; top: 0; z-index: 20; }
thead tr { background: var(--surf2); }
th {
  padding: 9px 12px; text-align: left;
  font-size: 10px; font-weight: 700; color: var(--txt-dim);
  letter-spacing: .7px; text-transform: uppercase;
  border-bottom: 1px solid var(--brd);
}

tbody tr { border-bottom: 1px solid rgba(37,45,61,.5); transition: background .1s; }
tbody tr:hover { background: rgba(59,130,246,.04); }
tbody tr:last-child { border-bottom: none; }
td { padding: 8px 12px; vertical-align: middle; }

/* cell types */
.c-row   { color: var(--txt-dim); font-size: 10px; font-family: var(--font-mono); text-align: center; }
.c-code  { font-family: var(--font-mono); font-size: 11px; color: var(--cyan); }
.c-name  { font-weight: 500; white-space: normal; max-width: 200px; }
.c-spec  { color: var(--txt-mute); font-size: 11px; white-space: normal; max-width: 220px; }
.c-unit  { color: var(--txt-dim); font-size: 11px; text-align: center; }
.c-src   { color: var(--txt-dim); font-size: 10px; font-family: var(--font-mono); }
.c-hl    { color: var(--yellow) !important; }

tr.sec-row td {
  background: rgba(59,130,246,.07); color: var(--blue);
  font-weight: 700; font-size: 11px;
  border-bottom: 1px solid rgba(59,130,246,.15);
  white-space: nowrap;
}

/* badges */
.badge {
  display: inline-flex; align-items: center; gap: 3px;
  padding: 3px 8px; border-radius: 4px;
  font-size: 10px; font-weight: 800; white-space: nowrap;
}
.bk { background: rgba(16,185,129,.15); color: var(--green); }
.bd { background: rgba(245,158,11,.15);  color: var(--yellow); }
.bm { background: rgba(239,68,68,.15);   color: var(--red); }
.b1 { background: rgba(59,130,246,.15);  color: var(--blue); }
.b2 { background: rgba(168,85,247,.15);  color: var(--purple); }
.bb { background: rgba(16,185,129,.15);  color: var(--green); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.state-box {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 72px 40px; gap: 12px;
  text-align: center; color: var(--txt-dim);
}
.state-icon { font-size: 44px; }
.state-title { font-size: 14px; font-weight: 700; color: var(--txt-mute); }
.state-desc  { font-size: 12px; line-height: 1.9; }
.state-desc b { color: var(--txt-mute); }

.spin-wrap {
  display: flex; align-items: center; gap: 12px;
  padding: 60px; justify-content: center;
  color: var(--txt-dim); font-size: 13px;
}
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--brd); border-top-color: var(--blue);
  border-radius: 50%; animation: spin .7s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>

<body>
<div id="app">

  <!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header">
    <div class="header-logo">ğŸ“‹</div>
    <div>
      <h1 class="header-title">ë‚´ì—­ ì½”ë“œ <em>ì²´í¬ ì‹œìŠ¤í…œ</em></h1>
      <p class="header-sub">ì›ë‚´ì—­ â†” ìì¬Â·ì¼ìœ„ëŒ€ê°€ ì½”ë“œê²€í†  &amp; í‘œì¤€ë‚´ì—­ í•­ëª©ë¹„êµ</p>
    </div>
    <div class="header-right">
      <a class="gh-badge" href="https://github.com" target="_blank" rel="noopener">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        GitHub Pages
      </a>
    </div>
  </header>

  <!-- â”€â”€ UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="upload-section">
    <div class="upload-section-title">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ â€” ë“œë˜ê·¸&ë“œë¡­ ë˜ëŠ” í´ë¦­</div>
    <div class="upload-grid">

      <div class="upcard" id="drop0">
        <input type="file" id="file0" accept=".xlsx,.xlsm,.xls">
        <div class="upcard-head">
          <div class="upcard-dot dot-blue"></div>
          <span class="upcard-name">ì›ë‚´ì—­</span>
          <span class="upcard-badge badge-req">í•„ìˆ˜</span>
        </div>
        <p class="upcard-desc">ê²€í†  ëŒ€ìƒ ì›ë‚´ì—­ íŒŒì¼</p>
        <p class="upcard-fn" id="fn0">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë¡­í•˜ì„¸ìš”</p>
      </div>

      <div class="upcard" id="drop1">
        <input type="file" id="file1" accept=".xlsx,.xlsm,.xls">
        <div class="upcard-head">
          <div class="upcard-dot dot-green"></div>
          <span class="upcard-name">ìì¬ë¦¬ìŠ¤íŠ¸</span>
          <span class="upcard-badge badge-req">ì½”ë“œê²€í† </span>
        </div>
        <p class="upcard-desc">ìì¬ ì½”ë“œ DB íŒŒì¼</p>
        <p class="upcard-fn" id="fn1">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë¡­í•˜ì„¸ìš”</p>
      </div>

      <div class="upcard" id="drop2">
        <input type="file" id="file2" accept=".xlsx,.xlsm,.xls">
        <div class="upcard-head">
          <div class="upcard-dot dot-yellow"></div>
          <span class="upcard-name">ì¼ìœ„ëŒ€ê°€ë¦¬ìŠ¤íŠ¸</span>
          <span class="upcard-badge badge-req">ì½”ë“œê²€í† </span>
        </div>
        <p class="upcard-desc">ì¼ìœ„ëŒ€ê°€ ì½”ë“œ DB íŒŒì¼</p>
        <p class="upcard-fn" id="fn2">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë¡­í•˜ì„¸ìš”</p>
      </div>

      <div class="upcard" id="drop3">
        <input type="file" id="file3" accept=".xlsx,.xlsm,.xls">
        <div class="upcard-head">
          <div class="upcard-dot dot-purple"></div>
          <span class="upcard-name">í‘œì¤€ë‚´ì—­</span>
          <span class="upcard-badge badge-opt">í‘œì¤€ë‚´ì—­ë¹„êµ</span>
        </div>
        <p class="upcard-desc">í‘œì¤€ë‚´ì—­ ë¹„êµ íŒŒì¼</p>
        <p class="upcard-fn" id="fn3">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë¡­í•˜ì„¸ìš”</p>
      </div>

    </div>
  </section>

  <!-- â”€â”€ ACTION BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="action-bar">
    <button class="btn btn-blue"   id="btnCode"   disabled onclick="runCodeCheck()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="5,3 19,12 5,21"/></svg>
      ì½”ë“œ ê²€í†  ì‹¤í–‰
    </button>
    <button class="btn btn-purple" id="btnStd"    disabled onclick="runStdCheck()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
      í‘œì¤€ë‚´ì—­ ë¹„êµ
    </button>
    <div class="divider"></div>
    <button class="btn btn-ghost"  id="btnExport" disabled onclick="exportResult()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      ê²°ê³¼ ì €ì¥
    </button>
    <button class="btn btn-ghost" onclick="resetAll()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="1,4 1,10 7,10"/><path d="M3.51 15a9 9 0 1 0 .49-3.51"/></svg>
      ì´ˆê¸°í™”
    </button>
  </div>

  <!-- â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="tabsEl" class="tabs" style="display:none">
    <button class="tab" id="tabCode" onclick="switchTab('code')">ğŸ“Œ ì½”ë“œ ê²€í†  ê²°ê³¼</button>
    <button class="tab" id="tabStd"  onclick="switchTab('std')">ğŸ“Š í‘œì¤€ë‚´ì—­ ë¹„êµ ê²°ê³¼</button>
  </div>

  <!-- â”€â”€ DYNAMIC AREAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="statsEl"></div>
  <div id="filterEl"></div>
  <div id="hintEl"></div>

  <!-- â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tbl-wrap">
    <div class="tbl-scroll" id="tableEl">
      <div class="state-box">
        <div class="state-icon">ğŸ“‹</div>
        <div class="state-title">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ê²€í† ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”</div>
        <div class="state-desc">
          <b>ì½”ë“œ ê²€í† </b>: ì›ë‚´ì—­ + ìì¬ë¦¬ìŠ¤íŠ¸ / ì¼ìœ„ëŒ€ê°€ë¦¬ìŠ¤íŠ¸ ì—…ë¡œë“œ í›„ â–¶ ì½”ë“œ ê²€í†  ì‹¤í–‰<br>
          <b>í‘œì¤€ë‚´ì—­ ë¹„êµ</b>: ì›ë‚´ì—­ + í‘œì¤€ë‚´ì—­ ì—…ë¡œë“œ í›„ â‡„ í‘œì¤€ë‚´ì—­ ë¹„êµ í´ë¦­
        </div>
      </div>
    </div>
  </div>

</div><!-- #app -->

<script>
/* ================================================================
   STATE
================================================================ */
const W = [null, null, null, null]; // [ì›ë‚´ì—­, ìì¬ë¦¬ìŠ¤íŠ¸, ì¼ìœ„ëŒ€ê°€, í‘œì¤€ë‚´ì—­]
const CLR = ['clr-blue','clr-green','clr-yellow','clr-purple'];

let codeRes = [], stdRes = [];
let curTab = '', curFilter = 'all', curSearch = '';

/* ================================================================
   FILE UPLOAD SETUP
================================================================ */
[0,1,2,3].forEach(i => {
  const inp  = document.getElementById('file'+i);
  const card = document.getElementById('drop'+i);
  const fnEl = document.getElementById('fn'+i);

  inp.addEventListener('change', e => { if (e.target.files[0]) loadWb(e.target.files[0], i, fnEl, card); });
  card.addEventListener('dragover',  e => { e.preventDefault(); card.classList.add('drag-over'); });
  card.addEventListener('dragleave', () => card.classList.remove('drag-over'));
  card.addEventListener('drop', e => {
    e.preventDefault(); card.classList.remove('drag-over');
    if (e.dataTransfer.files[0]) loadWb(e.dataTransfer.files[0], i, fnEl, card);
  });
});

function loadWb(file, i, fnEl, card) {
  fnEl.textContent = 'ë¡œë”© ì¤‘...'; fnEl.className = 'upcard-fn';
  const reader = new FileReader();
  reader.onload = e => {
    try {
      W[i] = XLSX.read(e.target.result, { type:'array', cellDates:false });
      fnEl.textContent = 'âœ“ ' + file.name;
      fnEl.className   = 'upcard-fn ok';
      card.classList.add('loaded', CLR[i]);
    } catch (err) {
      fnEl.textContent = 'âŒ ' + err.message;
    }
    updateBtns();
  };
  reader.readAsArrayBuffer(file);
}

function updateBtns() {
  document.getElementById('btnCode').disabled = !(W[0] && (W[1] || W[2]));
  document.getElementById('btnStd').disabled  = !(W[0] && W[3]);
}

/* ================================================================
   EXCEL UTILITIES
================================================================ */
const normH    = s => String(s||'').replace(/\s/g,'');
const normSpec = s => String(s||'').replace(/\s/g,'');
const esc      = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

function getRows(wb, sn) {
  const sh = wb.Sheets[sn];
  if (!sh) return null;
  return XLSX.utils.sheet_to_json(sh, { header:1, defval:'' });
}

function findHdrRow(rows) {
  for (let i = 0; i < Math.min(10, rows.length); i++)
    if (rows[i].some(c => normH(c) === 'ì½”ë“œ')) return i;
  return 2;
}

function getIdx(hdr) {
  return {
    ci: hdr.findIndex(c => normH(c) === 'ì½”ë“œ'),
    ni: hdr.findIndex(c => normH(c) === 'í’ˆëª…'),
    si: hdr.findIndex(c => normH(c) === 'ê·œê²©'),
    ui: hdr.findIndex(c => normH(c) === 'ë‹¨ìœ„'),
  };
}

/** Build code â†’ {name,spec,unit,src} map from a workbook */
function buildMap(wb, preferSheets) {
  const map   = new Map();
  const tried = new Set();
  for (const sn of [...preferSheets, ...wb.SheetNames]) {
    if (tried.has(sn)) continue; tried.add(sn);
    const rows = getRows(wb, sn); if (!rows) continue;
    const hr = findHdrRow(rows);
    const { ci, ni, si, ui } = getIdx(rows[hr]);
    if (ci < 0) continue;
    for (let r = hr + 1; r < rows.length; r++) {
      const code = String(rows[r][ci]||'').trim();
      if (!code || /^[0-9]{1,2}$/.test(code)) continue;
      if (!map.has(code)) map.set(code, {
        name: ni >= 0 ? String(rows[r][ni]||'').trim() : '',
        spec: si >= 0 ? String(rows[r][si]||'').trim() : '',
        unit: ui >= 0 ? String(rows[r][ui]||'').trim() : '',
        src: sn,
      });
    }
  }
  return map;
}

/** Parse ì›ë‚´ì—­ â†’ [{isSection, code, name, spec, unit, row}] */
function parseSource(wb) {
  const PRI = ['ì›ë‚´ì—­','ë‚´ì—­','Sheet1'];
  const sn  = PRI.find(s => wb.SheetNames.includes(s)) || wb.SheetNames[0];
  const rows = getRows(wb, sn);
  if (!rows) throw new Error('ì›ë‚´ì—­ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  const hr = findHdrRow(rows);
  const { ci, ni, si, ui } = getIdx(rows[hr]);
  const out = [];
  for (let r = hr + 1; r < rows.length; r++) {
    const code = String(rows[r][ci]||'').trim();
    if (!code) continue;
    if (/^[0-9]{1,2}$/.test(code)) {
      out.push({ isSection:true, code, name: ni>=0 ? String(rows[r][ni]||'').trim():'' });
      continue;
    }
    out.push({
      isSection: false, row: r + 1, code,
      name: ni >= 0 ? String(rows[r][ni]||'').trim() : '',
      spec: si >= 0 ? String(rows[r][si]||'').trim() : '',
      unit: ui >= 0 ? String(rows[r][ui]||'').trim() : '',
    });
  }
  return out;
}

/* ================================================================
   CODE CHECK â€” ìì¬ë¦¬ìŠ¤íŠ¸ + ì¼ìœ„ëŒ€ê°€ë¦¬ìŠ¤íŠ¸ ë§Œ ë¹„êµ
================================================================ */
function runCodeCheck() {
  showLoading('ì½”ë“œ ê²€í†  ì¤‘...');
  setTimeout(() => {
    try {
      const db = new Map();
      if (W[1]) buildMap(W[1], ['ìì¬ë¦¬ìŠ¤íŠ¸']).forEach((v,k) => { if (!db.has(k)) db.set(k,v); });
      if (W[2]) buildMap(W[2], ['ì¼ìœ„ëŒ€ê°€ë¦¬ìŠ¤íŠ¸']).forEach((v,k) => { if (!db.has(k)) db.set(k,v); });

      const src = parseSource(W[0]);
      codeRes = src.map(item => {
        if (item.isSection) return item;
        const d = db.get(item.code);
        if (!d) return { ...item, status:'miss', db:null };

        const ss = normSpec(item.spec), ds = normSpec(d.spec);
        const su = item.unit.trim(),    du = (d.unit||'').trim();
        const sn2 = item.name.trim(),   dn = (d.name||'').trim();

        const sdiff = ds !== ss && (ds || ss);
        const udiff = du !== su && (du || su);
        const ndiff = dn !== sn2 && (dn || sn2);

        return { ...item, status:(sdiff||udiff||ndiff)?'diff':'ok', db:d, sdiff, udiff, ndiff };
      });

      curTab = 'code'; curFilter = 'all'; curSearch = '';
      renderCode();
      showTabs();
      document.getElementById('btnExport').disabled = false;
    } catch (e) { showError(e.message); }
  }, 30);
}

function renderCode() {
  const f = curFilter, q = curSearch;
  const visible = codeRes.filter(r => {
    if (r.isSection) return f === 'all' && !q;
    if (q && !r.code.toLowerCase().includes(q) && !r.name.toLowerCase().includes(q)) return false;
    return f === 'all' || r.status === f;
  });

  const all  = codeRes.filter(r => !r.isSection);
  const N    = all.length;
  const nOk  = all.filter(r => r.status==='ok').length;
  const nDf  = all.filter(r => r.status==='diff').length;
  const nMs  = all.filter(r => r.status==='miss').length;

  setStats(`<div class="stats">
    <div class="stat"><div class="stat-lbl">ì „ì²´</div><div class="stat-num n-blue">${N}</div></div>
    <div class="stat"><div class="stat-lbl">âœ… ì¼ì¹˜</div><div class="stat-num n-green">${nOk}</div></div>
    <div class="stat"><div class="stat-lbl">âš  ì½”ë“œìƒì´</div><div class="stat-num n-yellow">${nDf}</div></div>
    <div class="stat"><div class="stat-lbl">âŒ DBì—†ìŒ</div><div class="stat-num n-red">${nMs}</div></div>
  </div>`);

  setFilter(`<div class="filter-bar">
    <button class="fbtn ${f==='all'?'fa-all':''}"  onclick="sf('all','code')">ì „ì²´ ${N}</button>
    <button class="fbtn ${f==='ok'?'fa-ok':''}"    onclick="sf('ok','code')">âœ… ì¼ì¹˜ ${nOk}</button>
    <button class="fbtn ${f==='diff'?'fa-diff':''}" onclick="sf('diff','code')">âš  ì½”ë“œìƒì´ ${nDf}</button>
    <button class="fbtn ${f==='miss'?'fa-miss':''}" onclick="sf('miss','code')">âŒ DBì—†ìŒ ${nMs}</button>
    <input class="search-box" id="si" placeholder="ì½”ë“œÂ·í’ˆëª… ê²€ìƒ‰..." value="${esc(q)}" oninput="ss(this.value,'code')">
  </div>`);

  setHint('');

  if (!visible.length) { showEmpty('ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ'); return; }

  let h = `<table><thead><tr>
    <th>í–‰</th><th>ì½”ë“œ</th><th>í’ˆëª… (ì›ë‚´ì—­)</th><th>ê·œê²© (ì›ë‚´ì—­)</th><th>ë‹¨ìœ„</th>
    <th>DB í’ˆëª…</th><th>DB ê·œê²©</th><th>DB ë‹¨ìœ„</th><th>ì¶œì²˜</th><th>ê²°ê³¼</th>
  </tr></thead><tbody>`;

  for (const r of visible) {
    if (r.isSection) {
      h += `<tr class="sec-row"><td colspan="10">â–¶ ${esc(r.name||r.code)}</td></tr>`;
      continue;
    }
    h += `<tr>
      <td class="c-row">${r.row}</td>
      <td class="c-code">${esc(r.code)}</td>
      <td class="c-name">${esc(r.name)}</td>
      <td class="c-spec">${esc(r.spec)}</td>
      <td class="c-unit">${esc(r.unit)}</td>
      <td class="c-name ${r.ndiff?'c-hl':''}">${esc(r.db?.name||'')}</td>
      <td class="c-spec ${r.sdiff?'c-hl':''}">${esc(r.db?.spec||'')}</td>
      <td class="c-unit ${r.udiff?'c-hl':''}">${esc(r.db?.unit||'')}</td>
      <td class="c-src">${esc(r.db?.src||'')}</td>
      <td>${codeBadge(r.status)}</td>
    </tr>`;
  }
  h += '</tbody></table>';
  document.getElementById('tableEl').innerHTML = h;
}

function codeBadge(s) {
  const m = { ok:['bk','âœ“ ì¼ì¹˜'], diff:['bd','âš  ì½”ë“œìƒì´'], miss:['bm','âœ• DBì—†ìŒ'] };
  const [c,l] = m[s] || ['bm',s];
  return `<span class="badge ${c}">${l}</span>`;
}

/* ================================================================
   STANDARD CHECK â€” í‘œì¤€ë‚´ì—­ ë§Œ ë¹„êµ
================================================================ */
function runStdCheck() {
  showLoading('í‘œì¤€ë‚´ì—­ ë¹„êµ ì¤‘...');
  setTimeout(() => {
    try {
      const allSrc   = parseSource(W[0]);
      const wonItems = allSrc.filter(r => !r.isSection);
      const wonCodes = new Set(wonItems.map(r => r.code));

      const stdMap    = buildMap(W[3], ['í‘œì¤€ë‚´ì—­']);
      const stdSecMap = buildStdSectionMap(W[3]);

      // â”€â”€ ì›ë‚´ì—­ ê³µì¢…ë³„ ë²„í‚· êµ¬ì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const secBuckets = [];   // [{secCode, secName, wonRows, only2Rows}]
      let   curBucket  = null;

      for (const item of allSrc) {
        if (item.isSection) {
          curBucket = { secCode:item.code, secName:item.name, wonRows:[], only2Rows:[] };
          secBuckets.push(curBucket);
        } else {
          if (!curBucket) {
            curBucket = { secCode:'', secName:'ë¯¸ë¶„ë¥˜', wonRows:[], only2Rows:[] };
            secBuckets.push(curBucket);
          }
          curBucket.wonRows.push(item);
        }
      }

      // â”€â”€ í‘œì¤€ë‚´ì—­ì—ë§Œ ìˆëŠ” í•­ëª©ì„ í•´ë‹¹ ê³µì¢… ë²„í‚·ì— ë°°ì • â”€â”€
      stdMap.forEach((v, code) => {
        if (wonCodes.has(code)) return;
        const sc = stdSecMap.get(code) || '';
        let   bk = secBuckets.find(b => b.secCode === sc);
        if (!bk) {
          let only2bk = secBuckets.find(b => b.secCode === '__only2__');
          if (!only2bk) {
            only2bk = { secCode:'__only2__', secName:'í‘œì¤€ë‚´ì—­ì—ë§Œ ì¡´ì¬', wonRows:[], only2Rows:[] };
            secBuckets.push(only2bk);
          }
          bk = only2bk;
        }
        bk.only2Rows.push({ isSection:false, code, name:v.name, spec:v.spec, unit:v.unit, status:'only2', si:v });
      });

      // â”€â”€ stdRes ì¡°ë¦½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      stdRes = [];
      for (const bk of secBuckets) {
        if (!bk.wonRows.length && !bk.only2Rows.length) continue;
        if (bk.secCode === '__only2__') {
          stdRes.push({ isSection:true, code:'', name:'ğŸ“ í‘œì¤€ë‚´ì—­ì—ë§Œ ì¡´ì¬í•˜ëŠ” í•­ëª©' });
        } else if (bk.secCode) {
          stdRes.push({ isSection:true, code:bk.secCode, name:bk.secName });
        }
        for (const item of bk.wonRows) {
          if (stdMap.has(item.code))
            stdRes.push({ ...item, status:'both', si:stdMap.get(item.code) });
          else
            stdRes.push({ ...item, status:'only1' });
        }
        for (const item of bk.only2Rows) stdRes.push(item);
      }

      curTab = 'std'; curFilter = 'all'; curSearch = '';
      renderStd();
      showTabs();
      document.getElementById('btnExport').disabled = false;
    } catch (e) { showError(e.message); }
  }, 30);
}

function buildStdSectionMap(wb) {
  const map   = new Map();
  const tried = new Set();
  for (const sn of ['í‘œì¤€ë‚´ì—­', ...wb.SheetNames]) {
    if (tried.has(sn)) continue; tried.add(sn);
    const rows = getRows(wb, sn); if (!rows) continue;
    const hr = findHdrRow(rows);
    const { ci } = getIdx(rows[hr]);
    if (ci < 0) continue;
    let sec = '';
    for (let r = hr + 1; r < rows.length; r++) {
      const code = String(rows[r][ci]||'').trim();
      if (!code) continue;
      if (/^[0-9]{1,2}$/.test(code)) { sec = code; continue; }
      map.set(code, sec);
    }
    break;
  }
  return map;
}

function renderStd() {
  const f = curFilter, q = curSearch;

  const items  = stdRes.filter(r => !r.isSection);
  const nOnly1 = items.filter(r => r.status==='only1').length;
  const nOnly2 = items.filter(r => r.status==='only2').length;
  const nBoth  = items.filter(r => r.status==='both').length;

  const visible = stdRes.filter(r => {
    if (r.isSection) {
      if (q) return false;
      if (f === 'all') return true;
      const idx = stdRes.indexOf(r);
      for (let i = idx + 1; i < stdRes.length; i++) {
        if (stdRes[i].isSection) break;
        if (stdRes[i].status === f) return true;
      }
      return false;
    }
    if (q && !r.code.toLowerCase().includes(q) && !r.name.toLowerCase().includes(q)) return false;
    return f === 'all' || r.status === f;
  });

  setStats(`<div class="stats">
    <div class="stat"><div class="stat-lbl">ì›ë‚´ì—­ í•­ëª©</div><div class="stat-num n-blue">${nOnly1+nBoth}</div></div>
    <div class="stat"><div class="stat-lbl">í‘œì¤€ë‚´ì—­ í•­ëª©</div><div class="stat-num n-purple">${nOnly2+nBoth}</div></div>
    <div class="stat"><div class="stat-lbl">âš¡ ì›ë‚´ì—­ì—ë§Œ</div><div class="stat-num n-blue">${nOnly1}</div></div>
    <div class="stat"><div class="stat-lbl">ğŸ“ í‘œì¤€ë‚´ì—­ì—ë§Œ</div><div class="stat-num n-purple">${nOnly2}</div></div>
    <div class="stat"><div class="stat-lbl">âœ… ì–‘ìª½ ëª¨ë‘</div><div class="stat-num n-green">${nBoth}</div></div>
  </div>`);

  setFilter(`<div class="filter-bar">
    <button class="fbtn ${f==='all'?'fa-all':''}"    onclick="sf('all','std')">ì „ì²´ ${items.length}</button>
    <button class="fbtn ${f==='only1'?'fa-only1':''}" onclick="sf('only1','std')">âš¡ ì›ë‚´ì—­ë§Œ ${nOnly1}</button>
    <button class="fbtn ${f==='only2'?'fa-only2':''}" onclick="sf('only2','std')">ğŸ“ í‘œì¤€ë‚´ì—­ë§Œ ${nOnly2}</button>
    <button class="fbtn ${f==='both'?'fa-both':''}"   onclick="sf('both','std')">âœ… ì–‘ìª½ ëª¨ë‘ ${nBoth}</button>
    <input class="search-box" id="si" placeholder="ì½”ë“œÂ·í’ˆëª… ê²€ìƒ‰..." value="${esc(q)}" oninput="ss(this.value,'std')">
  </div>`);

  setHint(`<div class="hint">
    <b>âš¡ ì›ë‚´ì—­ì—ë§Œ ì¡´ì¬</b> (${nOnly1}ê±´) â€” ì›ë‚´ì—­ì—ëŠ” ìˆìœ¼ë‚˜ í‘œì¤€ë‚´ì—­ì— ì—†ëŠ” í•­ëª© &nbsp;|&nbsp;
    <b>ğŸ“ í‘œì¤€ë‚´ì—­ì—ë§Œ ì¡´ì¬</b> (${nOnly2}ê±´) â€” í‘œì¤€ë‚´ì—­ì—ëŠ” ìˆìœ¼ë‚˜ ì›ë‚´ì—­ì— ì—†ëŠ” í•­ëª© &nbsp;|&nbsp;
    <b>âœ… ì–‘ìª½ ëª¨ë‘</b> (${nBoth}ê±´) â€” ë‘ ë‚´ì—­ ëª¨ë‘ì— ì½”ë“œ ì¡´ì¬
  </div>`);

  if (!visible.length) { showEmpty('ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ'); return; }

  let h = `<table><thead><tr>
    <th>êµ¬ë¶„</th><th>ì½”ë“œ</th>
    <th>ì›ë‚´ì—­ í’ˆëª…</th><th>ì›ë‚´ì—­ ê·œê²©</th><th>ì›ë‚´ì—­ ë‹¨ìœ„</th>
    <th>í‘œì¤€ë‚´ì—­ í’ˆëª…</th><th>í‘œì¤€ë‚´ì—­ ê·œê²©</th><th>í‘œì¤€ë‚´ì—­ ë‹¨ìœ„</th>
  </tr></thead><tbody>`;

  for (const r of visible) {
    if (r.isSection) {
      const lbl = r.code ? `[${esc(r.code)}] ${esc(r.name||'')}` : esc(r.name||'');
      h += `<tr class="sec-row"><td colspan="8">â–¶ ${lbl}</td></tr>`;
      continue;
    }
    const si      = r.si || {};
    const isOnly2 = r.status === 'only2';
    const dash    = `<span style="color:var(--txt-dim)">â€”</span>`;
    const sc      = isOnly2 ? 'color:var(--purple)' : 'color:var(--txt-mute)';

    h += `<tr>
      <td>${stdBadge(r.status)}</td>
      <td class="c-code">${esc(r.code)}</td>
      <td class="c-name">${isOnly2 ? dash : esc(r.name)}</td>
      <td class="c-spec">${isOnly2 ? dash : esc(r.spec)}</td>
      <td class="c-unit">${isOnly2 ? dash : esc(r.unit)}</td>
      <td class="c-name" style="${sc}">${esc(si.name||'')}</td>
      <td class="c-spec" style="${sc}">${esc(si.spec||'')}</td>
      <td class="c-unit" style="${sc}">${esc(si.unit||'')}</td>
    </tr>`;
  }
  h += '</tbody></table>';
  document.getElementById('tableEl').innerHTML = h;
}

function stdBadge(s) {
  const m = { only1:['b1','âš¡ ì›ë‚´ì—­ë§Œ'], only2:['b2','ğŸ“ í‘œì¤€ë‚´ì—­ë§Œ'], both:['bb','âœ… ì–‘ìª½'] };
  const [c,l] = m[s] || ['b1',s];
  return `<span class="badge ${c}">${l}</span>`;
}

/* ================================================================
   TABS / FILTER / SEARCH
================================================================ */
function showTabs() {
  document.getElementById('tabsEl').style.display = 'flex';
  document.getElementById('tabCode').className = 'tab' + (curTab==='code' ? ' active-blue'   : '');
  document.getElementById('tabStd').className  = 'tab' + (curTab==='std'  ? ' active-purple' : '');
}

function switchTab(tab) {
  curTab = tab; curFilter = 'all'; curSearch = '';
  showTabs();
  if (tab==='code' && codeRes.length) renderCode();
  else if (tab==='std' && stdRes.length) renderStd();
}

function sf(f, mode) { curFilter = f; mode==='code' ? renderCode() : renderStd(); }
function ss(v, mode) { curSearch = v.toLowerCase(); mode==='code' ? renderCode() : renderStd(); }

/* ================================================================
   EXPORT TO EXCEL
================================================================ */
function exportResult() {
  const wb = XLSX.utils.book_new();

  if (codeRes.length) {
    const rows = [['í–‰','ì½”ë“œ','í’ˆëª…','ê·œê²©','ë‹¨ìœ„','DB í’ˆëª…','DB ê·œê²©','DB ë‹¨ìœ„','ì¶œì²˜','ê²°ê³¼']];
    const L = { ok:'ì¼ì¹˜', diff:'ì½”ë“œìƒì´', miss:'í˜„ì¥ì½”ë“œ(DBì—†ìŒ)' };
    for (const r of codeRes) {
      if (r.isSection) { rows.push([`â–¶ ${r.name||r.code}`,'','','','','','','','','']); continue; }
      rows.push([r.row, r.code, r.name, r.spec, r.unit,
        r.db?.name||'', r.db?.spec||'', r.db?.unit||'', r.db?.src||'',
        L[r.status]||r.status]);
    }
    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = [5,14,22,24,6,22,24,6,14,14].map(w=>({wch:w}));
    XLSX.utils.book_append_sheet(wb, ws, 'ì½”ë“œê²€í† ê²°ê³¼');
  }

  if (stdRes.length) {
    const rows = [['êµ¬ë¶„','ì½”ë“œ','ì›ë‚´ì—­ í’ˆëª…','ì›ë‚´ì—­ ê·œê²©','ì›ë‚´ì—­ ë‹¨ìœ„','í‘œì¤€ë‚´ì—­ í’ˆëª…','í‘œì¤€ë‚´ì—­ ê·œê²©','í‘œì¤€ë‚´ì—­ ë‹¨ìœ„']];
    const L = { only1:'ì›ë‚´ì—­ë§Œ', only2:'í‘œì¤€ë‚´ì—­ë§Œ', both:'ì–‘ìª½ëª¨ë‘' };
    for (const r of stdRes) {
      if (r.isSection) { rows.push([`â–¶ ${r.code?'['+r.code+'] ':''}${r.name||''}`,'','','','','','','']); continue; }
      const si = r.si||{};
      rows.push([L[r.status]||r.status, r.code, r.name||'', r.spec||'', r.unit||'',
        si.name||'', si.spec||'', si.unit||'']);
    }
    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = [12,14,22,24,6,22,24,6].map(w=>({wch:w}));
    XLSX.utils.book_append_sheet(wb, ws, 'í‘œì¤€ë‚´ì—­ë¹„êµê²°ê³¼');
  }

  if (!wb.SheetNames.length) { alert('ë‚´ë³´ë‚¼ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤'); return; }
  XLSX.writeFile(wb, `ì½”ë“œì²´í¬ê²°ê³¼_${new Date().toISOString().slice(0,10)}.xlsx`);
}

/* ================================================================
   RESET
================================================================ */
function resetAll() {
  [0,1,2,3].forEach(i => {
    W[i] = null;
    document.getElementById('fn'+i).textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë¡­í•˜ì„¸ìš”';
    document.getElementById('fn'+i).className   = 'upcard-fn';
    const c = document.getElementById('drop'+i);
    c.classList.remove('loaded','clr-blue','clr-green','clr-yellow','clr-purple');
    document.getElementById('file'+i).value = '';
  });
  codeRes = []; stdRes = []; curTab = ''; curFilter = 'all'; curSearch = '';
  updateBtns();
  document.getElementById('btnExport').disabled = true;
  document.getElementById('tabsEl').style.display = 'none';
  setStats(''); setFilter(''); setHint('');
  document.getElementById('tableEl').innerHTML = `
    <div class="state-box">
      <div class="state-icon">ğŸ“‹</div>
      <div class="state-title">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ê²€í† ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”</div>
      <div class="state-desc">
        <b>ì½”ë“œ ê²€í† </b>: ì›ë‚´ì—­ + ìì¬ë¦¬ìŠ¤íŠ¸ / ì¼ìœ„ëŒ€ê°€ë¦¬ìŠ¤íŠ¸ ì—…ë¡œë“œ í›„ â–¶ ì½”ë“œ ê²€í†  ì‹¤í–‰<br>
        <b>í‘œì¤€ë‚´ì—­ ë¹„êµ</b>: ì›ë‚´ì—­ + í‘œì¤€ë‚´ì—­ ì—…ë¡œë“œ í›„ â‡„ í‘œì¤€ë‚´ì—­ ë¹„êµ í´ë¦­
      </div>
    </div>`;
}

/* ================================================================
   DOM HELPERS
================================================================ */
function showLoading(msg='ë¶„ì„ ì¤‘...') {
  document.getElementById('tableEl').innerHTML =
    `<div class="spin-wrap"><div class="spinner"></div>${msg}</div>`;
  setStats(''); setFilter(''); setHint('');
}
function showError(msg) {
  document.getElementById('tableEl').innerHTML =
    `<div class="state-box"><div class="state-icon">âŒ</div>
     <div class="state-title">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>
     <div class="state-desc">${esc(msg)}</div></div>`;
}
function showEmpty(msg) {
  document.getElementById('tableEl').innerHTML =
    `<div class="state-box"><div class="state-icon">ğŸ”</div>
     <div class="state-title">${esc(msg)}</div></div>`;
}
function setStats(h)  { document.getElementById('statsEl').innerHTML  = h; }
function setFilter(h) { document.getElementById('filterEl').innerHTML = h; }
function setHint(h)   { document.getElementById('hintEl').innerHTML   = h; }
</script>
</body>
</html>
